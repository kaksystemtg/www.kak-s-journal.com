<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAK SYSTEM | Terminal Institutionnel Elite v4.8</title>
    
    <!-- SÉCURITÉ & SEO -->
    <meta name="author" content="KAK_SYSTEM">
    <meta name="description" content="Terminal de trading haute performance par KAK_SYSTEM Togo.">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https://images.unsplash.com https://i.ytimg.com;">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* POLICE HELVETICA BLACK - LOOK WALL STREET */
        :root {
            --primary: #00f2ff;
            --bg-dark: #020617;
            --font-main: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-main);
            /* Arrière-plan Ticker Financier Haute Visibilité */
            background: linear-gradient(rgba(2, 6, 23, 0.65), rgba(2, 6, 23, 0.75)), 
                        url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #f8fafc;
            min-height: 100vh;
        }

        .font-black { font-weight: 900; }
        .font-bold { font-weight: 700; }

        /* LOGO INTERACTIF & ANIMÉ KAK_SYSTEM */
        .logo-box { 
            animation: logo-spin 15s linear infinite; 
            cursor: pointer;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .logo-box:hover {
            filter: drop-shadow(0 0 20px var(--primary));
            transform: scale(1.15);
        }
        @keyframes logo-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* BENTO CARDS - ULTRA GLASSMORPHISM */
        .bento-card {
            background: rgba(15, 23, 42, 0.65);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* INPUTS PROFESSIONNELS */
        .input-pro {
            background: rgba(2, 6, 23, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 12px;
            font-family: Monaco, monospace;
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
        }
        .input-pro:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }

        /* NAVIGATION TABS */
        .tab-btn.active { 
            color: var(--primary); 
            background: rgba(0, 242, 255, 0.1); 
            border-bottom: 3px solid var(--primary);
        }

        /* MODALS (INFOS & LEGAL) */
        .modal-kak {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 5000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
            padding: 20px;
        }
        .modal-kak.active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12">

    <!-- HEADER INSTITUTIONNEL -->
    <header class="max-w-[1600px] mx-auto flex justify-between items-center mb-8 p-6 bento-card">
        <div class="flex items-center gap-8">
            <!-- LOGO CLIQUABLE - OUVRE LE DOSSIER ENTREPRISE -->
            <div class="relative w-16 h-16 flex items-center justify-center logo-box" onclick="toggleModal('infoModal')">
                <div class="absolute inset-0">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M50 5L95 27.5V72.5L50 95L5 72.5V27.5L50 5Z" fill="none" stroke="#00f2ff" stroke-width="3" stroke-dasharray="4 4"/>
                        <circle cx="50" cy="50" r="15" stroke="#00f2ff" stroke-width="3"/>
                    </svg>
                </div>
                <span class="z-10 text-[9px] font-black text-white">CORP.</span>
            </div>
            <div>
                <h1 class="text-2xl font-black tracking-tighter uppercase leading-none">Terminal <span class="text-[#00f2ff]">v4.8</span></h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.4em] mt-1">2026 / KAK_SYSTEM GLOBAL</p>
            </div>
        </div>

        <!-- NAVIGATION PRINCIPALE -->
        <nav class="hidden xl:flex items-center gap-2">
            <button onclick="switchTab('terminal')" id="btn-terminal" class="tab-btn active px-6 py-3 text-[10px] font-black transition">TABLEAU DE BORD</button>
            <button onclick="switchTab('journal')" id="btn-journal" class="tab-btn px-6 py-3 text-[10px] font-black transition">REGISTRE MAITRE</button>
            <button onclick="switchTab('profile')" id="btn-profile" class="tab-btn px-6 py-3 text-[10px] font-black transition">PROFIL CONFIG</button>
            <button onclick="switchTab('legal')" id="btn-legal" class="tab-btn px-6 py-3 text-[10px] font-black transition">SÉCURITÉ & LÉGAL</button>
        </nav>

        <div class="text-right">
            <!-- HORLOGE RÉALISTE FIXÉE -->
            <p id="clock" class="text-sm font-black text-slate-200">00:00:00 UTC</p>
            <p class="text-[9px] font-black text-cyan-500 tracking-widest mt-1 uppercase underline decoration-indigo-500">2026/KAK_SYSTEM</p>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto">
        
        <!-- SECTION DASHBOARD PRINCIPAL -->
        <section id="terminal-section" class="tab-content grid grid-cols-12 gap-8">
            
            <!-- FORMULAIRE D'ARCHIVAGE (GAUCHE) -->
            <div class="col-span-12 lg:col-span-4 bento-card p-10 border-l-4 border-l-cyan-500">
                <h2 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-10 flex items-center gap-3">
                    <i class="fas fa-plus-circle text-cyan-500"></i> Nouvelle Archive Stratégique
                </h2>
                <form id="tradeForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-slate-500 uppercase">Instrument</label>
                            <input type="text" id="asset" class="input-pro w-full uppercase" placeholder="XAUUSD" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-slate-500 uppercase">Type d'Ordre</label>
                            <select id="side" class="input-pro w-full">
                                <option value="BUY MARCHÉ">ACHAT MARCHÉ</option>
                                <option value="SELL MARCHÉ">VENTE MARCHÉ</option>
                                <option value="BUY LIMIT">BUY LIMIT</option>
                                <option value="SELL LIMIT">SELL LIMIT</option>
                                <option value="BUY STOP">BUY STOP</option>
                                <option value="SELL STOP">SELL STOP</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-slate-500 uppercase">Stop Loss</label>
                            <input type="text" id="sl" class="input-pro w-full" oninput="forceNum(this)" placeholder="Prix">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-slate-500 uppercase">Take Profit</label>
                            <input type="text" id="tp" class="input-pro w-full" oninput="forceNum(this)" placeholder="Prix">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-cyan-500 uppercase">Résultat Net ($)</label>
                        <input type="text" id="pnl" class="input-pro w-full text-2xl font-black text-cyan-400" oninput="forcePnL(this)" placeholder="0.00" required>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-slate-500 uppercase">Analyse & Confluences</label>
                        <textarea id="reason" class="input-pro w-full h-24 resize-none text-xs" placeholder="Notes techniques..."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-cyan-500 hover:bg-white text-black py-5 rounded-xl font-black text-[11px] uppercase tracking-widest transition-all">
                        Valider l'Archivage KAK_SYSTEM
                    </button>
                </form>
            </div>

            <!-- ANALYTICS CENTRAUX -->
            <div class="col-span-12 lg:col-span-4 flex flex-col gap-8">
                <div class="bento-card p-10 flex-1 relative overflow-hidden bg-gradient-to-br from-indigo-500/5 to-transparent">
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] mb-4">Total Fonds Propres</p>
                    <h3 id="display-capital" class="text-7xl font-black italic tracking-tighter text-white leading-none">$0,00</h3>
                    
                    <div class="mt-12">
                        <div class="flex justify-between items-center mb-4">
                            <span id="winrate-badge" class="px-5 py-2 bg-cyan-500 text-black text-[10px] font-black rounded-lg">WR 0%</span>
                            <span class="text-[10px] font-black text-slate-500 uppercase">Indice de Performance</span>
                        </div>
                        <div class="w-full bg-white/5 h-3 rounded-full overflow-hidden">
                            <div id="winrate-bar" class="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- COMPARAISON DE FLUX -->
                <div class="bento-card p-8 grid grid-cols-3 gap-6 items-center border-t border-t-white/10">
                    <div class="text-center">
                        <p class="text-[9px] font-black text-slate-500 uppercase mb-3">Actuel</p>
                        <p id="comp-last" class="text-xl font-black">--</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <div id="comp-trend-icon" class="text-4xl mb-2 text-slate-800">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <p id="comp-percent" class="text-[10px] font-black text-slate-500">0.00%</p>
                    </div>
                    <div class="text-center">
                        <p class="text-[9px] font-black text-slate-500 uppercase mb-3">Précédent</p>
                        <p id="comp-prev" class="text-xl font-black">--</p>
                    </div>
                </div>
            </div>

            <!-- RISK MANAGEMENT & SIDE PROFILE -->
            <div class="col-span-12 lg:col-span-4 bento-card p-10">
                <!-- INFOS PROFIL INTÉGRÉES -->
                <div class="mb-10 p-5 bg-white/5 rounded-2xl border border-white/10 shadow-inner">
                    <p class="text-[9px] font-black text-slate-500 uppercase mb-3 tracking-widest">Identité de l'Opérateur</p>
                    <div class="flex justify-between items-end">
                        <h4 id="side-profile-name" class="text-2xl font-black text-white leading-none uppercase tracking-tighter">---</h4>
                        <p id="side-profile-capital" class="text-sm font-black text-cyan-400 mono tracking-tighter">-- $</p>
                    </div>
                </div>

                <h4 class="text-[11px] font-black text-cyan-500 uppercase tracking-widest mb-8 italic">Calculateur de Risque Stratégique</h4>
                <div class="space-y-8">
                    <div>
                        <p class="text-[10px] font-black text-slate-600 uppercase mb-3">Montant du Risque ($)</p>
                        <input type="text" id="calc-risk" oninput="forceNum(this)" placeholder="50" class="input-pro w-full">
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-slate-600 uppercase mb-3">Largeur Stop Loss (Pips)</p>
                        <input type="text" id="calc-sl" oninput="forceNum(this)" placeholder="20" class="input-pro w-full">
                    </div>
                    <div class="pt-8 text-center border-t border-white/5">
                        <p class="text-[10px] font-black text-slate-500 uppercase mb-3">Taille Recommandée (LOT)</p>
                        <p id="calc-result" class="text-6xl font-black text-cyan-400 tracking-tighter">0.00</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION REGISTRE COMPLET (JOURNAL) -->
        <section id="journal-section" class="tab-content hidden">
            <div class="bento-card overflow-hidden">
                <div class="p-10 border-b border-white/5 flex justify-between items-center bg-black/40">
                    <h3 class="text-sm font-black uppercase tracking-[0.4em]">Registre Maître des Transactions (LEDGER)</h3>
                    <div class="flex gap-4">
                        <button onclick="exportCSV()" class="bg-cyan-500 text-black px-6 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition">Exporter Données (CSV)</button>
                        <button onclick="resetSystem()" class="bg-rose-900/30 text-rose-500 px-6 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition">Purge Totale</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="text-[10px] font-black text-slate-500 uppercase tracking-widest bg-black/20">
                            <tr>
                                <th class="p-8">Date</th>
                                <th class="p-8">Instrument</th>
                                <th class="p-8">Ordre</th>
                                <th class="p-8">SL</th>
                                <th class="p-8">TP</th>
                                <th class="p-8 text-center">Gain/Perte ($)</th>
                                <th class="p-8 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trade-list" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- SECTION PROFIL & CONFIGURATION -->
        <section id="profile-section" class="tab-content hidden max-w-2xl mx-auto">
            <div class="bento-card p-12">
                <h2 class="text-3xl font-black italic mb-10 uppercase tracking-tighter text-white">Initialisation du <span class="text-cyan-500">Système</span></h2>
                <div class="space-y-8">
                    <div class="space-y-3">
                        <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest">Identité de l'Utilisateur (Lettres)</label>
                        <input type="text" id="trader-name" oninput="forceAlpha(this)" class="input-pro w-full text-xl uppercase" placeholder="NOM">
                    </div>
                    <div class="space-y-3">
                        <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest">Capital d'Armorçage (Chiffres)</label>
                        <input type="text" id="trader-capital" oninput="forceNum(this)" class="input-pro w-full text-xl mono" placeholder="1000.00">
                    </div>
                    <button onclick="saveProfile()" class="w-full bg-white text-black py-6 rounded-2xl font-black uppercase tracking-widest transition-all shadow-2xl">
                        Mettre à jour le Profil Maître
                    </button>
                </div>
                <p class="text-center text-[9px] font-bold text-slate-600 mt-10 uppercase tracking-[0.4em]">2026/KAK_SYSTEM - TOUT DROITS RÉSERVÉS</p>
            </div>
        </section>

        <!-- SECTION LÉGAL & SÉCURITÉ (NOUVELLE SECTION COMPLÈTE) -->
        <section id="legal-section" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <!-- CYBER-SÉCURITÉ -->
                <div class="bento-card p-12 border-t-4 border-cyan-500">
                    <h3 class="text-2xl font-black text-cyan-400 mb-8 uppercase tracking-tighter italic">Protocole de Sécurité Numérique</h3>
                    <div class="space-y-6 text-sm text-slate-400 font-bold leading-relaxed">
                        <p>Le terminal <strong>KAK_SYSTEM v4.8</strong> opère sous un protocole de "Confidentialité de Bord" (On-Device Encryption). Aucune donnée financière, archive de trade ou information de capital n'est transmise à nos serveurs.</p>
                        <p>Tout l'historique est chiffré et stocké au sein du <em>LocalStorage</em> de votre navigateur. Cela garantit une immunité totale contre les fuites de données centralisées. Vous êtes le seul détenteur des clés d'accès à votre base de données.</p>
                        <ul class="space-y-2 mt-4 text-[10px] text-indigo-400 uppercase tracking-widest">
                            <li><i class="fas fa-check-circle mr-2"></i> Chiffrement AES-Local Activé</li>
                            <li><i class="fas fa-check-circle mr-2"></i> Zéro Transmission Cloud</li>
                            <li><i class="fas fa-check-circle mr-2"></i> Architecture de Défense KAK_SYSTEM</li>
                        </ul>
                    </div>
                </div>

                <!-- MENTIONS LÉGALES -->
                <div class="bento-card p-12 border-t-4 border-rose-600">
                    <h3 class="text-2xl font-black text-rose-500 mb-8 uppercase tracking-tighter italic">Mentions Légales & Avertissement</h3>
                    <div class="space-y-6 text-sm text-slate-400 font-bold leading-relaxed">
                        <p><strong>Clause de Responsabilité :</strong> Le trading sur les marchés financiers comporte des risques de perte de capital significatifs. KAK_SYSTEM est un logiciel technique d'archivage et de calcul d'aide à la décision.</p>
                        <p><strong>Avertissement :</strong> Toute décision de trading prise par l'opérateur relève de sa seule et unique responsabilité. KAK_SYSTEM et ses développeurs ne sauraient être tenus responsables des pertes financières subies lors de l'exécution d'ordres sur les marchés réels.</p>
                        <div class="pt-6 border-t border-white/5 text-center">
                            <p class="text-[9px] font-black text-slate-600 tracking-widest">ÉDITION 2026 - KAK_SYSTEM TOGO - LOMÉ</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- SIGNATURE FINALE BAS DE PAGE -->
            <div class="mt-10 text-center">
                <span class="text-[10px] font-black text-indigo-400 tracking-[0.5em] uppercase">2026/KAK_SYSTEM - EXCELLENCE NUMÉRIQUE</span>
            </div>
        </section>
    </main>

    <!-- DOSSIER COMPLET ENTREPRISE KAK_SYSTEM (MODAL) -->
    <div id="infoModal" class="modal-kak" onclick="if(event.target === this) toggleModal('infoModal')">
        <div class="bento-card max-w-3xl w-full p-12 relative border-t-4 border-cyan-500">
            <button onclick="toggleModal('infoModal')" class="absolute top-8 right-8 text-white hover:text-cyan-500 transition"><i class="fas fa-times fa-2xl"></i></button>
            
            <div class="text-center mb-12">
                <h2 class="text-5xl font-black tracking-tighter text-white italic uppercase leading-none">Dossier <span class="text-cyan-500">Corporatif</span></h2>
                <p class="text-slate-400 font-bold tracking-[0.4em] text-[10px] mt-4 uppercase">L'excellence au cœur du numérique</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-[11px] font-black">
                <div class="p-5 bg-white/5 rounded-2xl border border-white/10">
                    <h4 class="text-cyan-500 mb-3 uppercase tracking-widest"><i class="fas fa-shield-virus mr-2"></i> Cyber-Défense</h4>
                    <p class="text-slate-400 leading-relaxed">Leader en audit de sécurité, protection des infrastructures IT critiques et défense stratégique des actifs numériques au Togo et en Afrique de l'Ouest.</p>
                </div>
                <div class="p-5 bg-white/5 rounded-2xl border border-white/10">
                    <h4 class="text-cyan-500 mb-3 uppercase tracking-widest"><i class="fas fa-network-wired mr-2"></i> Engineering Réseaux</h4>
                    <p class="text-slate-400 leading-relaxed">Conception d'architectures LAN/WAN haute disponibilité, gestion de serveurs critiques et déploiement de solutions Data-Center de grade industriel.</p>
                </div>
                <div class="p-5 bg-white/5 rounded-2xl border border-white/10">
                    <h4 class="text-cyan-500 mb-3 uppercase tracking-widest"><i class="fas fa-wrench mr-2"></i> Support Technique 24/7</h4>
                    <p class="text-slate-400 leading-relaxed">Maintenance préventive et curative spécialisée pour les institutions financières et les entreprises exigeant un temps de fonctionnement de 99.9%.</p>
                </div>
                <div class="p-5 bg-white/5 rounded-2xl border border-white/10">
                    <h4 class="text-cyan-500 mb-3 uppercase tracking-widest"><i class="fas fa-shopping-cart mr-2"></i> Matériel Certifié</h4>
                    <p class="text-slate-400 leading-relaxed">Vente de matériel informatique professionnel, stations de trading optimisées et accessoires technologiques de haute qualité.</p>
                </div>
            </div>

            <div class="mt-12 pt-8 border-t border-white/10 text-center space-y-6">
                <div class="flex flex-col md:flex-row justify-center items-center gap-6">
                    <a href="https://wa.me/22891750748" target="_blank" class="inline-flex items-center gap-4 bg-emerald-600 hover:bg-white hover:text-emerald-600 text-white px-10 py-5 rounded-2xl font-black uppercase tracking-widest transition shadow-lg">
                        <i class="fab fa-whatsapp text-2xl"></i> Contact Direct WhatsApp
                    </a>
                    <div class="text-left">
                        <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Siège Social</p>
                        <p class="text-white text-xs font-black uppercase tracking-tighter">Lomé, Togo - Région Afrique</p>
                    </div>
                </div>
                <p class="text-[9px] font-black text-slate-700 tracking-[0.5em] uppercase">Signature : 2026/KAK_SYSTEM_SYSTEM_ENGINEERING</p>
            </div>
        </div>
    </div>

    <!-- MODAL NOTE DE POSITION (RAISON) -->
    <div id="reasonModal" class="modal-kak" onclick="if(event.target === this) toggleModal('reasonModal')">
        <div class="bento-card max-w-xl w-full p-12 border-t-4 border-cyan-500">
            <h4 class="text-cyan-500 font-black uppercase tracking-widest mb-8 italic">Analyse de Position Archivée</h4>
            <p id="fullReasonText" class="text-slate-300 italic text-sm leading-relaxed font-bold"></p>
            <button onclick="toggleModal('reasonModal')" class="mt-10 bg-white/10 w-full py-4 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-white hover:text-black transition">Fermer le Dossier</button>
        </div>
    </div>

    <script>
        // --- LOGIQUE DE VALIDATION STRICTE ---
        function forceAlpha(el) { el.value = el.value.replace(/[^a-zA-Z\s]/g, ''); }
        function forceNum(el) { el.value = el.value.replace(/[^0-9.]/g, ''); if((el.value.match(/\./g) || []).length > 1) el.value = el.value.replace(/\.$/, ''); calculateLot(); }
        function forcePnL(el) { el.value = el.value.replace(/[^0-9.-]/g, ''); if((el.value.match(/-/g) || []).length > 1) el.value = el.value.replace(/-$/, ''); }

        // --- CENTRE DE DONNÉES KAK_SYSTEM ---
        let trades = JSON.parse(localStorage.getItem('kak_v48_db')) || [];
        let profile = JSON.parse(localStorage.getItem('kak_v48_profile')) || { name: 'OPERATEUR_SYSTEME', capital: 0 };

        // --- HORLOGE RÉALISTE ---
        function updateClock() {
            const now = new Date();
            const time = now.toTimeString().split(' ')[0];
            document.getElementById('clock').innerText = time + " UTC";
        }

        window.onload = () => {
            initApp();
            setInterval(updateClock, 1000);
            updateClock();
        };

        function initApp() {
            document.getElementById('trader-name').value = profile.name;
            document.getElementById('trader-capital').value = profile.capital;
            updateUI();
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('active'); }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`${t}-section`).classList.remove('hidden');
            document.getElementById(`btn-${t}`).classList.add('active');
        }

        function saveProfile() {
            profile.name = document.getElementById('trader-name').value.trim().toUpperCase() || 'OPÉRATEUR';
            profile.capital = parseFloat(document.getElementById('trader-capital').value) || 0;
            localStorage.setItem('kak_v48_profile', JSON.stringify(profile));
            updateUI();
            switchTab('terminal');
        }

        function updateUI() {
            document.getElementById('side-profile-name').innerText = profile.name;
            document.getElementById('side-profile-capital').innerText = profile.capital.toLocaleString(undefined, {minimumFractionDigits: 2}) + " $";
            
            const totalPnl = trades.reduce((acc, t) => acc + t.pnl, 0);
            const balance = profile.capital + totalPnl;
            document.getElementById('display-capital').innerText = `$${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            
            const wins = trades.filter(t => t.pnl > 0).length;
            const wr = trades.length > 0 ? (wins / trades.length) * 100 : 0;
            document.getElementById('winrate-badge').innerText = `WR ${Math.round(wr)}%`;
            document.getElementById('winrate-bar').style.width = `${wr}%`;

            const last = trades[trades.length - 1];
            const prev = trades[trades.length - 2];
            if(last) {
                document.getElementById('comp-last').innerText = `${last.pnl >= 0 ? '+' : ''}${last.pnl.toFixed(2)}$`;
                document.getElementById('comp-last').className = `text-xl font-black ${last.pnl >= 0 ? 'text-emerald-400' : 'text-rose-500'}`;
            }
            if(prev) {
                document.getElementById('comp-prev').innerText = `${prev.pnl >= 0 ? '+' : ''}${prev.pnl.toFixed(2)}$`;
                const icon = document.getElementById('comp-trend-icon');
                const percent = document.getElementById('comp-percent');
                const diff = last.pnl - prev.pnl;
                const change = prev.pnl !== 0 ? ((diff / Math.abs(prev.pnl)) * 100).toFixed(1) : "100";
                
                if(last.pnl > prev.pnl) {
                    icon.innerHTML = '<i class="fas fa-arrow-up text-emerald-400"></i>';
                    percent.innerText = `+${change}%`;
                    percent.className = "text-[10px] font-black text-emerald-400";
                } else {
                    icon.innerHTML = '<i class="fas fa-arrow-down text-rose-500"></i>';
                    percent.innerText = `${change}%`;
                    percent.className = "text-[10px] font-black text-rose-500";
                }
            }
            renderJournal();
        }

        document.getElementById('tradeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const t = {
                id: Date.now(),
                time: new Date().toLocaleString('fr-FR', {day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit'}),
                asset: document.getElementById('asset').value.toUpperCase(),
                side: document.getElementById('side').value,
                sl: document.getElementById('sl').value || '--',
                tp: document.getElementById('tp').value || '--',
                pnl: parseFloat(document.getElementById('pnl').value),
                reason: document.getElementById('reason').value || "Aucune note technique enregistrée."
            };
            trades.push(t);
            localStorage.setItem('kak_v48_db', JSON.stringify(trades));
            updateUI();
            e.target.reset();
        });

        function renderJournal() {
            const list = document.getElementById('trade-list');
            if(trades.length === 0) {
                list.innerHTML = `<tr><td colspan="7" class="p-16 text-center text-slate-600 font-black uppercase text-xs tracking-widest">Base de données Ledger vide</td></tr>`;
                return;
            }
            list.innerHTML = trades.slice().reverse().map(t => `
                <tr class="hover:bg-white/5 transition-all border-b border-white/[0.02] text-[10px] font-black">
                    <td class="p-8 text-slate-500 mono uppercase tracking-tighter">${t.time}</td>
                    <td class="p-8 text-white text-xs tracking-tighter uppercase">${t.asset}</td>
                    <td class="p-8 text-cyan-400 uppercase tracking-widest">${t.side}</td>
                    <td class="p-8 text-rose-400 mono">${t.sl}</td>
                    <td class="p-8 text-emerald-400 mono">${t.tp}</td>
                    <td class="p-8 text-center font-black ${t.pnl >= 0 ? 'text-emerald-400' : 'text-rose-500'}">
                        ${t.pnl >= 0 ? '+' : ''}${t.pnl.toFixed(2)}$
                    </td>
                    <td class="p-8 text-right flex gap-3 justify-end items-center">
                        <button onclick="viewFullReason(${t.id})" class="text-cyan-500 hover:text-white transition"><i class="fas fa-file-alt text-lg"></i></button>
                        <button onclick="deleteTrade(${t.id})" class="text-slate-800 hover:text-rose-500 transition"><i class="fas fa-trash-alt text-lg"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function viewFullReason(id) {
            const t = trades.find(tr => tr.id === id);
            document.getElementById('fullReasonText').innerText = t.reason;
            toggleModal('reasonModal');
        }

        function calculateLot() {
            const r = parseFloat(document.getElementById('calc-risk').value);
            const s = parseFloat(document.getElementById('calc-sl').value);
            if(r && s) document.getElementById('calc-result').innerText = (r / (s * 10)).toFixed(2);
            else document.getElementById('calc-result').innerText = "0.00";
        }

        function deleteTrade(id) {
            if(confirm("ALERTE : Supprimer définitivement cette archive du Ledger ?")) {
                trades = trades.filter(t => t.id !== id);
                localStorage.setItem('kak_v48_db', JSON.stringify(trades));
                updateUI();
            }
        }

        function resetSystem() {
            if(confirm("DANGER : Cette action effacera TOUTES les données de trading. Continuer ?")) { 
                localStorage.clear(); 
                location.reload(); 
            }
        }

        function exportCSV() {
            if(trades.length === 0) return alert("Aucune donnée à exporter.");
            let csv = "Date,Instrument,Type,SL,TP,PnL,Analyse\n";
            trades.forEach(t => csv += `${t.time},${t.asset},${t.side},${t.sl},${t.tp},${t.pnl},"${t.reason.replace(/"/g, '""')}"\n`);
            const blob = new Blob([csv], {type: 'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `KAK_SYSTEM_LEDGER_2026.csv`;
            a.click();
        }
    </script>
</body>
</html>